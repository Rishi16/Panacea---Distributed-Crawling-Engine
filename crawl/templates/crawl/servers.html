<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>PANACEA - A better way</title>

    <!-- Bootstrap core CSS -->
    <link href='{% static "crawl/assets/css/bootstrap.css" %}' rel="stylesheet"/>
    <!--external css-->
    <link href='{% static "crawl/assets/font-awesome/css/font-awesome.css" %}' rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href='{% static "crawl/assets/css/zabuto_calendar.css" %}'>
    <link rel="stylesheet" type="text/css" href='{% static "crawl/assets/js/gritter/css/jquery.gritter.css" %}' />
    <link rel="stylesheet" type="text/css" href='{% static "crawl/assets/lineicons/style.css" %}'>
	<link rel="stylesheet" type="text/css" href='{% static "crawl/assets/js/gritter/css/jquery.gritter.css" %}' />

    <!-- Custom styles for this template -->
    <link href='{% static "crawl/assets/css/style.css" %}' rel="stylesheet">
    <link href='{% static "crawl/assets/css/style-responsive.css" %}' rel="stylesheet">

    <script src='{% static "crawl/assets/js/chart-master/Chart.js" %}'></script>

	<style>
	.scrollable_team {
    height: 500px; /* or any value */
    overflow-y: auto;
	}
	</style>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="." class="logo"><b>Panacea Crawling Monitor</b></a>
            <!--logo end-->
            <div class="nav notify-row" id="top_menu">
                <!--  notification start -->
                <ul class="nav top-menu">
                    <!-- settings start -->
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href=".">
                            <i class="fa fa-tasks"></i>
                            <span class="badge bg-theme">4</span>
                        </a>
                        <ul class="dropdown-menu extended tasks-bar">
                            <div class="notify-arrow notify-arrow-green"></div>
                            <li>
                                <p class="green">You have 4 pending Batches</p>
                            </li>
                            <li>
                                <a href=".">
                                    <div class="task-info">
                                        <div class="desc">Lazada PH</div>
                                        <div class="percent">40%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href=".">
                                    <div class="task-info">
                                        <div class="desc">Farnell NO</div>
                                        <div class="percent">60%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <div class="task-info">
                                        <div class="desc">Shoppee PH</div>
                                        <div class="percent">80%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <div class="task-info">
                                        <div class="desc">11street MY</div>
                                        <div class="percent">70%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%">
                                            <span class="sr-only">70% Complete (Important)</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="external">
                                <a href="#">See All Tasks</a>
                            </li>
                        </ul>
                    </li>
                    <!-- settings end -->
                    <!-- inbox dropdown start-->
                    <li id="header_inbox_bar" class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                            <i class="fa fa-envelope-o"></i>
                            <span class="badge bg-theme">5</span>
                        </a>
                        <ul class="dropdown-menu extended inbox">
                            <div class="notify-arrow notify-arrow-green"></div>
                            <li>
                                <p class="green">You have 5 new messages</p>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src='{% static "crawl/assets/img/ui-zac.jpg" %}'></span>
                                    <span class="subject">
                                    <span class="from">Ramesh Kumar</span>
                                    <span class="time">Just now</span>
                                    </span>
                                    <span class="message">
                                        Hi mate, how is everything?
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src='{% static "crawl/assets/img/ui-divya.jpg" %}'></span>
                                    <span class="subject">
                                    <span class="from">Shamal Panchal</span>
                                    <span class="time">40 mins.</span>
                                    </span>
                                    <span class="message">
                                     Hi, I need your help with this.
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src='{% static "crawl/assets/img/ui-danro.jpg" %}'></span>
                                    <span class="subject">
                                    <span class="from">Shailesh Jha</span>
                                    <span class="time">2 hrs.</span>
                                    </span>
                                    <span class="message">
                                        Love your new Dashboard.
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src='{% static "crawl/assets/img/ui-sherman.jpg" %}'></span>
                                    <span class="subject">
                                    <span class="from">Nilesh Jadhav</span>
                                    <span class="time">4 hrs.</span>
                                    </span>
                                    <span class="message">
                                        Please, answer asap.
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">See all messages</a>
                            </li>
                        </ul>
                    </li>
                    <!-- inbox dropdown end -->
                </ul>
                <!--  notification end -->
            </div>
            <div class="top-menu">
            	<ul class="nav pull-right top-menu">
                    <li><a class="logout" href="/crawl">Logout</a></li>
            	</ul>
            </div>
        </header>
      <!--header end-->

      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">

              	  <p class="centered"><a href="profile.html"><img src='{% static "crawl/assets/img/ui-sam.jpg" %}' class="img-circle" width="60"></a></p>
              	  <h5 class="centered">{{username}}</h5>

                  <li class="mt">
                      <a href="/crawl/dashboard">
                          <i class="fa fa-dashboard"></i>
                          <span>Dashboard</span>
                      </a>
                  </li>

                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-desktop"></i>
                          <span>Server Monitor</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="/crawl/add_server">Add Server</a></li>
                          <li><a  href="general.html">My Servers</a></li>
                          <li><a  href="buttons.html">Team's Servers</a></li>
                          <li><a  href="panels.html">Server Performance</a></li>
                      </ul>
                  </li>

                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Components</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="calendar.html">Calendar</a></li>
                          <li><a  href="gallery.html">Gallery</a></li>
                          <li><a  href="todo_list.html">Todo List</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a class="active" href="javascript:;" >
                          <i class="fa fa-cogs"></i>
                          <span>Batch Management</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="/crawl/new">Create New Batch</a></li>
                          <li class="active"><a  href="/crawl/mybatches">My Batches</a></li>
                          <li><a  href="lock_screen.html">Team's Batches</a></li>
                      </ul>
                  </li>
				  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-paper-plane"></i>
                          <span>Script Management</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="/crawl/script">Upload New Script</a></li>
                          <li><a  href="/crawl/myscripts">My Scripts</a></li>
                          <li><a  href="lock_screen.html">Team's Scripts</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-tasks"></i>
                          <span>Forms</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="form_component.html">Form Components</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-th"></i>
                          <span>Data Tables</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="basic_table.html">Basic Table</a></li>
                          <li><a  href="responsive_table.html">Responsive Table</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class=" fa fa-bar-chart-o"></i>
                          <span>Charts</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="morris.html">Morris</a></li>
                          <li><a  href="chartjs.html">Chartjs</a></li>
                      </ul>
                  </li>

              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->

      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
				<h3><i class="fa fa-angle-right"></i> {{batch_data.batch_name}}</h3>
				<div class="row mt">
					<div class="col-lg-12">
                        <a href='/crawl/edit_batch/{{batch_data.id}}'><button class="btn btn-info btn-xs" style="font-size: 120%; margin:5px" onclick='{{buttons.edit_button_onclick}}' {{buttons.edit_button_disabled}}><i class='{{buttons.edit_button_class}}'>{{buttons.edit_button_text}}</i></button></a>
						<button id="pause_batch" class="btn btn-primary btn-xs" style="font-size: 120%; margin:5px" onclick='{{buttons.pause_button_onclick}}' {{buttons.pause_button_disabled}}><i class='{{buttons.pause_button_class}}'>{{buttons.pause_button_text}}</i></button>
						<button id="stop_batch" class="btn btn-warning btn-xs" data-toggle="modal" data-target='#stop_{{ batch_data.id }}' style="font-size: 120%; margin:5px" {{buttons.stop_button_disabled}}><i class='{{buttons.stop_button_class}}'>{{buttons.stop_button_text}}</i></button>
                        <div class="modal fade" id='stop_{{ batch_data.id }}' tabindex="-1" role="dialog" aria-labelledby="stopLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id='stopLabel_{{ batch_data.id }}'>Force Stop Batch</h4>
                                  </div>
                                  <div class="modal-body">
                                    Forcing the batch will lead to open database connections from all servers.<br>
                                    Do you really want to force stop batch - {{batch_data.batch_name}}?
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="force_batch()">Yes</button>
                                  </div>
                                </div>
                              </div>
                            </div>
						<button id="delete_batch" class="btn btn-danger btn-xs" data-toggle="modal" data-target='#myModal_{{ batch_data.id }}' style="font-size: 120%; margin:5px" {{buttons.delete_button_disabled}}><i class='{{buttons.delete_button_class}}'>{{buttons.delete_button_text}}</i></button>
                            <div class="modal fade" id='myModal_{{ batch_data.id }}' tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id='myModalLabel_{{ batch_data.id }}'>Delete Batch</h4>
                                  </div>
                                  <div class="modal-body">
                                    Do you really want to delete batch - {{batch_data.batch_name}}
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="delete_batch({{ batch_data.id }})">Yes</button>
                                  </div>
                                </div>
                              </div>
                            </div>
						<button id="generate_batch" class="btn btn-success btn-xs" style="font-size: 120%; margin:5px" onclick='{{buttons.generate_button_onclick}}' {{buttons.generate_button_disabled}}><i class='{{buttons.generate_button_class}}'>{{buttons.generate_button_text}}</i></button>
						<div class="btn-group">
<!--						<a id="download_batch" class='btn btn-success btn-xs {{buttons.report_button_disabled}}' style="font-size: 120%; margin-left:5px"{{buttons.report_button_href}}><i class='{{buttons.report_button_class}}'>{{buttons.report_button_text}}</i></a>-->
						<a id="download_batch" class="btn btn-success btn-xs" style="font-size: 120%; margin-left:5px" {{buttons.report_button_href}}><i class='{{buttons.report_button_class}}'>{{buttons.report_button_text}}</i></a>
<!--						<button id="download_batch_all" type="button" class='btn btn-success btn-xs dropdown-toggle dropdown-toggle-split {{buttons.report_button_disabled}}' style="font-size: 120%; margin-right:5px" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-->
						<button id="download_batch_all" type="button" class="btn btn-success btn-xs dropdown-toggle dropdown-toggle-split" style="font-size: 120%; margin-right:5px" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<span class="caret"></span>
						</button>
						  <div class="dropdown-menu">
                          {% for item in reports %}
							<a class="btn dropdown-item" href='/crawl/download_report/{{batch_data.id}}/?run_id={{item.report}}'><b>{{item.report}}</b>: {{item.creation_date}}</a>
							<div class="dropdown-divider"></div>
                          {% endfor %}
						  </div>
						</div>
						<div class="btn-group">
							<button id="recrawl_batch" class="btn btn-danger btn-xs dropdown-toggle dropdown-toggle-split" style="font-size: 120%; margin:5px" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" {{buttons.recrawl_button_disabled}}><i class='{{buttons.recrawl_button_class}}'>{{buttons.recrawl_button_text}}</i>
							<span class="caret"></span>
							</button>
								<style>
								label:hover {
								  cursor:pointer;
								}
								</style>
							  <div class="dropdown-menu">
								<label class="fa form-check-label keep_button"><input type="checkbox" name="recrawl" value="found" class="form-check-input keep_button" style="margin: 5px;">Found</label>
								<div class="dropdown-divider"></div>
								<label class="fa form-check-label keep_button"><input type="checkbox" name="recrawl" value="pnf" class="form-check-input keep_button" style="margin: 5px;">PNF</label>
								<div class="dropdown-divider"></div>
								<label class="fa form-check-label keep_button"><input type="checkbox" name="recrawl" value="proxy_blocked" class="form-check-input keep_button" style="margin: 5px;">Proxy Blocked</label>
								<div class="dropdown-divider"></div>
								<label class="fa form-check-label keep_button"><input type="checkbox" name="recrawl" value="tag_failed" class="form-check-input keep_button" style="margin: 5px;">Tag Failed</label>
								<div class="dropdown-divider"></div>
								<label class="fa form-check-label keep_button"><input type="checkbox" name="recrawl" value="other_exception" class="form-check-input keep_button" style="margin: 5px;">Other Exception</label>
								<div class="dropdown-divider"></div>
								<a class="btn btn-success btn-xs" style="font-size: 120%; margin-right:5px; position: relative; float: right;" id="recrawl" onclick="recrawl()"  href="#"><i class="fa">Recrawl</i></a>
							  </div>
						</div>
<!--                        <a href='/crawl/analyze_proxy/{{batch_data.id}}'><button id="analyze_proxy" class="btn btn-success btn-xs" {{buttons.report_button_disabled}} style="font-size: 120%; margin:5px">Regenerate Proxy Analysis</button></a>-->
                        <a href='/crawl/batch_proxy/{{batch_data.id}}'><button id="batch_proxy" class="btn btn-success btn-xs" {{buttons.report_button_disabled}} style="font-size: 120%; margin:5px">Proxy Analysis</button></a>
					</div>
				</div>
                {% for server in server_list %}
                <div class="row mt">
                    <div class="col-md-4 col-sm-4 mb" style="font-size: 90%">
                      		<div class="white-panel pn donut-chart">
                      			<div class="white-header">
						  			<h5 id="server_name_header">{{server.server_name}}</h5>
                                    <div class="row">
                                        <div class="col-sm-6 col-xs-6">
                                            <p style="color: #538997" id="cpu"><span>{{server.cpu}}</span></p>
                                        </div>
                                        <div class="col-sm-6 col-xs-6 ">
                                            <p style="color: #538997" id="ram"><span>{{server.ram}}</span></p>
                                        </div>
	                      		    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-xs-6">
                                            <p style="color: #538997" id="disk"><span>{{server.ram_pct}} </span></p>
                                        </div>
	                      		    </div>
                      			</div>
                            </div>
                    </div>
                </div>
                {% endfor %}

      <footer class="site-footer">
          <div class="text-center">
              Developer - Harsh Dubey
              <a href="index.html#" class="go-top">
                  <i class="fa fa-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>
      </section>

  </section>
    <!-- js placed at the end of the document so the pages load faster -->
    <script src='{% static "crawl/assets/js/jquery.js" %}'></script>
    <script src='{% static "crawl/assets/js/jquery-1.8.3.min.js" %}'></script>
    <script src='{% static "crawl/assets/js/bootstrap.min.js" %}'></script>
    <script class="include" type="text/javascript" src='{% static "crawl/assets/js/jquery.dcjqaccordion.2.7.js" %}'></script>
    <script src='{% static "crawl/assets/js/jquery.scrollTo.min.js" %}'></script>
    <script src='{% static "crawl/assets/js/jquery.nicescroll.js" %}' type="text/javascript"></script>
    <script src='{% static "crawl/assets/js/jquery.sparkline.js" %}'></script>


    <!--common script for all pages-->
    <script src='{% static "crawl/assets/js/common-scripts.js" %}'></script>

    <script type="text/javascript" src='{% static "crawl/assets/js/gritter/js/jquery.gritter.js" %}'></script>
    <script type="text/javascript" src='{% static "crawl/assets/js/gritter-conf.js" %}'></script>


    <!--script for this page-->
	<script src='{% static "crawl/assets/js/zabuto_calendar.js" %}'></script>
	<script src='{% static "crawl/assets/js/sparkline-chart.js" %}'></script>
	<script src='{% static "crawl/assets/js/guage.min.js" %}'></script>

	<script type="text/javascript">

		$('.keep_button').click(function(e) {
			e.stopPropagation();
		});

        function edit_batch() {
        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Edit',
            // (string | mandatory) the text inside the notification
            text: 'You are about to edit this batch.',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: false,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
        return false;
        }
        function delete_batch(batch_id) {
        		$.getJSON('/crawl/delete_batch/' + String(batch_id),
                    function (data) {
                        var json = data["data"];
						$('#batch_id_'+String(batch_id)).parent().remove();
						var unique_id = $.gritter.add({
						// (string | mandatory) the heading of the notification
						title: 'Batch deleted successfully',
						// (string | mandatory) the text inside the notification
						text: 'Please wait...!',
						// (bool | optional) if you want it to fade out on its own or just sit there
						sticky: false,
						// (int | optional) the time you want it to be alive for before fading out
						time: '',
						// (string | optional) the class name you want to apply to that specific message
						class_name: 'my-sticky-class'
						});
                    });
                window.history.go(-1); return false;
	    }
		function pause_batch() {

		$.getJSON('/crawl/change_batch_status/{{batch_data.id}}/paused',
                    function (data) {
                        var json = data["data"];
                    });
		//<button id="pause_batch" class="btn btn-primary btn-xs" style="font-size: 120%; margin:5px" onclick="pause_batch()"><i class="fa fa-pause"> Pause</i></button>
		$("#pause_batch").find('i').removeClass("fa fa-pause").addClass("fa fa-play");
		$('#pause_batch').find('i').html(" Resume");
		$("#pause_batch").attr("onclick","resume_batch()");


        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Pause',
            // (string | mandatory) the text inside the notification
            text: 'You are about to pause this batch.',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: false,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
        return false;
        }

        function force_batch() {

		$.getJSON('/crawl/change_batch_status/{{batch_data.id}}/forced',
                    function (data) {
                        var json = data["data"];
                    });
		//<button id="pause_batch" class="btn btn-primary btn-xs" style="font-size: 120%; margin:5px" onclick="pause_batch()"><i class="fa fa-pause"> Pause</i></button>
		$("#pause_batch").find('i').removeClass("fa fa-pause").addClass("fa fa-play");
		$('#pause_batch').find('i').html(" Resume");
		$("#pause_batch").attr("onclick","resume_batch()");


        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Pause',
            // (string | mandatory) the text inside the notification
            text: 'You are about to pause this batch.',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: false,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
        return false;
        }

		function resume_batch() {

		$.getJSON('/crawl/change_batch_status/{{batch_data.id}}/resumed',
                    function (data) {
                        var json = data["data"];
                    });
		//<button id="pause_batch" class="btn btn-primary btn-xs" style="font-size: 120%; margin:5px" onclick="pause_batch()"><i class="fa fa-pause"> Pause</i></button>
		$("#pause_batch").find('i').removeClass("fa fa-play").addClass("fa fa-pause");
		$('#pause_batch').find('i').html(" Pause");
		$("#pause_batch").attr("onclick","pause_batch()");
		$("#download_batch").removeAttr("href");
		$("#download_batch").addClass("disabled");
		$("#download_batch_all").addClass("disabled");
		$("#recrawl_batch").addClass("disabled");
		$("#generate_batch").attr("disabled", false);



        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Pause',
            // (string | mandatory) the text inside the notification
            text: 'You are about to pause this batch.',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: false,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
        return false;
        }
		function stop_batch() {
        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Stop',
            // (string | mandatory) the text inside the notification
            text: 'You are about to stop this batch.',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: false,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
        return false;
        }

		function generate_report() {

		var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Generating report',
            // (string | mandatory) the text inside the notification
            text: 'Please wait...!',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: true,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
		$("#generate_batch").attr("disabled", true);
		$.getJSON('/crawl/generate_report/{{batch_data.id}}',
                    function (data) {
						$.gritter.remove(1);
                        var json = data["msg"];
						report_location = data["report_location"];
						var unique_id = $.gritter.add({
						// (string | mandatory) the heading of the notification
						title: 'Report Generation',
						// (string | mandatory) the text inside the notification
						text: json,
						// (bool | optional) if you want it to fade out on its own or just sit there
						sticky: true,
						// (int | optional) the time you want it to be alive for before fading out
						time: '',
						// (string | optional) the class name you want to apply to that specific message
						class_name: 'my-sticky-class'
						});
						$("#download_batch").removeClass("disabled");
						$("#download_batch_all").removeClass("disabled");
						$("#download_batch").attr("href", report_location);
                    });

        return false;
        }

	    function update_recent_requests() {
            $.getJSON('/crawl/update_recent_requests/{{batch_data.id}}',
            function (data) {
                var requests_line = data["data"];
                $('#recent_requests').html(requests_line);
                });
	    }

	    function update_completion_estimate() {
            $.getJSON('/crawl/update_completion_estimate/{{batch_data.id}}',
            function (data) {
                var eta_line = data["eta"];
                $('#completion_estimate').html(eta_line);
                });
	    }
	    function recrawl() {
	        var re_options = [];
            $.each($("input[name='recrawl']:checked"), function(){
                re_options.push($(this).val());
            });
            alert("My favourite sports are: " + re_options.join(", "));
        }

	</script>

	<script type="application/javascript">
        $(document).ready(function () {
            $("#date-popover").popover({html: true, trigger: "manual"});
            $("#date-popover").hide();
            $("#date-popover").click(function (e) {
                $(this).hide();
            });

            $("#my-calendar").zabuto_calendar({
                action: function () {
                    return myDateFunction(this.id, false);
                },
                action_nav: function () {
                    return myNavFunction(this.id);
                },
                ajax: {
                    url: "show_data.php?action=1",
                    modal: true
                },
                legend: [
                    {type: "text", label: "Special event", badge: "00"},
                    {type: "block", label: "Regular event", }
                ]
            });
        });


        function myNavFunction(id) {
            $("#date-popover").hide();
            var nav = $("#" + id).data("navigation");
            var to = $("#" + id).data("to");
            console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
        }
    </script>

	<script type="application/javascript">
	$(document).ready(function () {
	$.gritter.add({
            // (string | mandatory) the heading of the notification
            title: '{{msg_to_show}}',
            // (string | mandatory) the text inside the notification
            text: '{{detailed_message}}'
        });
	setTimeout(function(){
    //do what you need here
	setInterval(run_background, 5000);
	}, 3000);

	});
	update_recent_requests();
	function run_background(){
		update_status_data();
		update_recent_requests();
		update_completion_estimate();
	}

	//increase_val=true;

	function add(accumulator, a) {
		return accumulator + a;
	}

	function update_status_data(){
		//$('#completion_found').html("YEAH");
		$.getJSON('/crawl/update_batch_status/{{batch_data.id}}',
                    function (data) {
                        var json = data["data"];
                        $('#batch_status').html("Batch status - " + json["status"] + " | Batch Progess -  " + json["completion_pcnt"] + " %");
                        $('#completion_found').find('span').html(" Found - " + json["completion_found"] + "<br/>(" + json["completion_found_pcnt"] + "%)");
                        $('#completion_pnf').find('span').html(" PNF - " + json["completion_pnf"] + "<br/>(" + json["completion_pnf_pcnt"] + "%)");
                        $('#completion_proxy_blocked').find('span').html(" Blocked - " + json["completion_proxy_blocked"] + "<br/>(" + json["completion_proxy_blocked_pcnt"] + "%)");
                        $('#completion_tag_failed').find('span').html(" Tag - " + json["completion_tag_failed"] + "<br/>(" + json["completion_tag_failed_pcnt"] + "%)");
						refresh_status(Number(json["completion_pcnt"]));
						var server_speed = [90];
						const sum = server_speed.reduce(add);
						refresh_status1(Number(sum));
                    });
	}

//	function update_batch_buttons(status){
//		if (status == "paused") {
//			$("#pause_batch").find('i').removeClass("fa fa-play").addClass("fa fa-pause");
//			$('#pause_batch').find('i').html(" Pause");
//			$("#pause_batch").attr("onclick","pause_batch()");
//		}
//	}


	function refresh_status(val_overall_progress){
		// Check the progress for each doughnut
		//if (val_overall_progress==100){
		//	increase_val=false;}
		//if (val_overall_progress==40){
		//	increase_val=true;}
		//if (increase_val==true){
		//	val_overall_progress++;}
		//if (increase_val==false){
		//	val_overall_progress--;}


		// assign new progress values
		doughnutData_overall_progress = [
				{
					value: val_overall_progress,
					color:"#21AC21"
				},
				{
					value : (100-val_overall_progress),
					color : "#fdfdfd"
				}
			];
		myDoughnut_overall_progress.Doughnut2(doughnutData_overall_progress)
	}


	function refresh_status1(val_overall_progress){
		$("#overall_speed").attr("data-value",val_overall_progress);
	}
  </script>


  </body>
</html>